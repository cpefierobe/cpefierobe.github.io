<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
  <title>Générateur A4 grille</title>

  <style>
    body { font-family: sans-serif; padding:20px; }
    canvas { border:1px solid #aaa; margin-top:20px; }
  </style>
</head>

<body>
  <h2>Générateur A4 (grille, ordre aléatoire)</h2>

  <button onclick="generer()">Générer</button>
  <button onclick="saveComposition()">Enregistrer composition</button>
  <button onclick="saveFond()">Enregistrer fond numéroté</button>

<script>

  // A4 paysage en 300dpi : 3508 × 2480 px
  const A4_W = 3508;
  const A4_H = 2480;

  // Taille réduite du fond pour limiter le poids du fichier généré
  const FOND_W = 1800;   // ajustable
  const FOND_H = 1270;   // ajustable

  let imgs = [];
  let positions = [];
  let fond;
  let composition, fondNum;

  let ordre = []; // contient les numéros 1..25 mélangés

  function preload() {
    for (let i = 1; i <= 25; i++) {
      imgs[i] = loadImage("tag" + i + ".png");
    }
    fond = loadImage("fond.jpg");
  }

  function setup() {
    createCanvas(700, 500);
    noLoop();
  }

  function generer() {
    genererOrdre();
    arrangerGrille();
    dessinerComposition();
    dessinerFond();
    image(composition, 0, 0, width, height);
  }

  // -------------------------------------------------------
  // Mélanger 1..25
  // -------------------------------------------------------
  function genererOrdre() {
    ordre = [];
    for (let i = 1; i <= 25; i++) ordre.push(i);

    // mélange Fisher-Yates
    for (let i = ordre.length - 1; i > 0; i--) {
      let j = floor(random(i + 1));
      [ordre[i], ordre[j]] = [ordre[j], ordre[i]];
    }
  }

  // -------------------------------------------------------
  // Placement en grille 5×5
  // -------------------------------------------------------
  function arrangerGrille() {
    positions = [];

    const cols = 5;
    const rows = 5;
    const margin = 120;
    const cellW = (A4_W - 2 * margin) / cols;
    const cellH = (A4_H - 2 * margin) / rows;

    let idx = 0;

    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        let x = margin + c * cellW + cellW / 2;
        let y = margin + r * cellH + cellH / 2;

        let numeroImage = ordre[idx];
        idx++;

        positions[numeroImage] = {x, y, cellW, cellH};
      }
    }
  }

  // -------------------------------------------------------
  // Composition avec les 25 images
  // -------------------------------------------------------
  function dessinerComposition() {
    composition = createGraphics(A4_W, A4_H);
    composition.background(255);

    for (let i = 1; i <= 25; i++) {
      let p = positions[i];
      let maxSize = min(p.cellW * 0.8, p.cellH * 0.8);
      let ratio = maxSize / max(imgs[i].width, imgs[i].height);
      let w = imgs[i].width * ratio;
      let h = imgs[i].height * ratio;

      composition.imageMode(CENTER);
      composition.image(imgs[i], p.x, p.y, w, h);
    }
  }

  // -------------------------------------------------------
  // Fond réduit + carrés numérotés
  // -------------------------------------------------------
  function dessinerFond() {
  fondNum = createGraphics(FOND_W, FOND_H);

  // fond réduit
  fondNum.image(fond, 0, 0, FOND_W, FOND_H);

  let scaleX = FOND_W / A4_W;
  let scaleY = FOND_H / A4_H;

  fondNum.rectMode(CENTER);
  fondNum.textAlign(CENTER, CENTER);
  fondNum.textSize(50);

  for (let i = 1; i <= 25; i++) {
    let p = positions[i];

    let x = p.x * scaleX;
    let y = p.y * scaleY;
    let s = min(p.cellW, p.cellH) * 0.7 * scaleX;

    // --- Double bordure autour du carré ---
    // Contour noir fin
    fondNum.stroke(0);
    fondNum.strokeWeight(3);
    fondNum.noFill();
    fondNum.rect(x, y, s, s, 18);

    // Bordure blanche par-dessus
    fondNum.stroke(255);
    fondNum.strokeWeight(1.5);
    fondNum.noFill();
    fondNum.rect(x, y, s, s, 18);

    // --- Double trait pour le chiffre ---
    // Chiffre contour noir
    fondNum.fill(0);
    fondNum.noStroke();
    fondNum.stroke(0);
    fondNum.strokeWeight(6);
    fondNum.text(i, x, y);

    // Chiffre blanc par-dessus
    fondNum.noStroke();
    fondNum.fill(255);
    fondNum.text(i, x, y);
  }
}


  // -------------------------------------------------------
  // Sauvegarde
  // -------------------------------------------------------
  function saveComposition() {
    if (composition) save(composition, "composition_A4_grille.png");
  }

  function saveFond() {
    if (fondNum) save(fondNum, "fond_num_A4_legere.png");
  }

</script>

</body>
</html>
