<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
  <title>Générateur A4 paysage</title>

  <style>
    body { font-family: sans-serif; padding:20px; }
    canvas { border:1px solid #aaa; margin-top:20px; }
  </style>
</head>

<body>
  <h2>Générateur A4 en paysage</h2>

  <button onclick="generer()">Générer</button>
  <button onclick="saveComposition()">Enregistrer composition</button>
  <button onclick="saveFond()">Enregistrer fond numéroté</button>

<script>

  // A4 paysage en 300dpi : 3508 × 2480 px
  const A4_W = 3508;   // largeur
  const A4_H = 2480;   // hauteur

  let imgs = [];
  let positions = [];
  let fond;
  let composition, fondNum;

  function preload() {
    for (let i = 1; i <= 25; i++) {
      imgs[i] = loadImage("tag" + i + ".png");
    }
    fond = loadImage("fond.png");
  }

  function setup() {
    createCanvas(700, 500); // aperçu réduit
    noLoop();
  }

  function generer() {
    arrangerImages();
    dessinerComposition();
    dessinerFond();
    image(composition, 0, 0, width, height);
  }

  // -------------------------------------------------------
  // Placement harmonieux en grille 5 × 5
  // -------------------------------------------------------
  function arrangerImages() {
    positions = [];

    const cols = 5;
    const rows = 5;
    const margin = 100;
    const cellW = (A4_W - 2*margin) / cols;
    const cellH = (A4_H - 2*margin) / rows;

    let idx = 1;

    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        let x = margin + c * cellW + cellW / 2;
        let y = margin + r * cellH + cellH / 2;
        positions[idx] = {x, y};
        idx++;
      }
    }
  }

  // -------------------------------------------------------
  // Composition avec toutes les images
  // -------------------------------------------------------
  function dessinerComposition() {
    composition = createGraphics(A4_W, A4_H);
    composition.background(255);

    for (let i = 1; i <= 25; i++) {
      let p = positions[i];

      let maxSize = min((A4_W / 5) * 0.7, (A4_H / 5) * 0.7);
      let ratio = maxSize / max(imgs[i].width, imgs[i].height);
      let w = imgs[i].width * ratio;
      let h = imgs[i].height * ratio;

      composition.imageMode(CENTER);
      composition.image(imgs[i], p.x, p.y, w, h);
    }
  }

  // -------------------------------------------------------
  // Fond + carrés numérotés
  // -------------------------------------------------------
  function dessinerFond() {
    fondNum = createGraphics(A4_W, A4_H);

    // Fond plein
    fondNum.image(fond, 0, 0, A4_W, A4_H);

    // Numéros aux mêmes positions
    fondNum.rectMode(CENTER);
    fondNum.textAlign(CENTER, CENTER);
    fondNum.textSize(80);
    fondNum.stroke(0);
    fondNum.fill(255, 200);

    for (let i = 1; i <= 25; i++) {
      let p = positions[i];
      let s = A4_W / 15; // taille des carrés

      fondNum.rect(p.x, p.y, s, s, 20);
      fondNum.fill(0);
      fondNum.text(i, p.x, p.y);
      fondNum.fill(255, 200);
    }
  }

  // -------------------------------------------------------
  // Sauvegarde
  // -------------------------------------------------------
  function saveComposition() {
    if (composition) save(composition, "composition_A4.png");
  }

  function saveFond() {
    if (fondNum) save(fondNum, "fond_num_A4.png");
  }

</script>

</body>
</html>
