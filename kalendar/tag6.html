<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Bildkodierung RGB mod 256</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/p5@1.7.0/lib/p5.min.js"></script>

  <style>
body {
font-family: Arial, sans-serif;
margin: 0;
padding: 20px;
display: flex;
flex-direction: column;
align-items: center;
background: #fafafa;
box-sizing: border-box;
}


p {
max-width: 500px;
font-size: 1.1rem;
line-height: 1.5;
}


label, input, button {
font-size: 1.1rem;
width: 100%;
max-width: 420px;
margin-top: 14px;
box-sizing: border-box;
}


input {
padding: 8px;
}


button {
padding: 10px;
background: #0066cc;
border: none;
border-radius: 8px;
color: white;
font-weight: bold;
}


button:disabled {
background: #888;
}


#canvasContainer {
margin-top: 25px;
width: 100%;
max-width: 520px;
display: flex;
justify-content: center;
}
</style>
</head>
<body>

<div>

<p>Erinnerst du dich an Brief Nr. 2, Morty? Du musst ihn entschlüsseln!</p>

<p>Dazu kannst du ihn in die App unten laden und die Codes R, G und B verwenden, die du gestern gefunden hast.</p>

<p>Viel Erfolg, Morty!</p>
</div>

<label>Bild auswählen:</label>
<input type="file" id="imageLoader" accept="image/*">

<label>Schlüssel R:</label>
<input type="number" id="keyR" value="3">

<label>Schlüssel G:</label>
<input type="number" id="keyG" value="5">

<label>Schlüssel B:</label>
<input type="number" id="keyB" value="7">

<button id="encodeBtn">Kodieren</button>
<button id="downloadBtn" disabled>Herunterladen</button>

<div id="canvasContainer"></div>

<script>
let originalImg = null;
let encodedImg = null;
let canvas = null;

function setup() {
  // Canvas plein écran largeur (hauteur fixe)
  canvas = createCanvas(windowWidth * 0.95, windowHeight * 0.6);
  canvas.parent("canvasContainer");
  background(255);

  document.getElementById("imageLoader").addEventListener("change", handleFile);
  document.getElementById("encodeBtn").addEventListener("click", encodeImage);
  document.getElementById("downloadBtn").addEventListener("click", downloadImage);
}


// Chargement + affichage immédiat
function handleFile(event) {
  let file = event.target.files[0];
  if (!file) return;

  let url = URL.createObjectURL(file);

  loadImage(url, img => {
    originalImg = img;
    encodedImg = null;
    background(255);
    drawImageFit(originalImg);
    document.getElementById("downloadBtn").disabled = true;
  });
}


// Affiche l’image dans le canvas sans toucher au canvas
function drawImageFit(img) {
  let w = img.width;
  let h = img.height;

  let ratio = min(width / w, height / h);
  let newW = w * ratio;
  let newH = h * ratio;

  image(img, (width - newW) / 2, (height - newH) / 2, newW, newH);
}


// Encoder l’image
function encodeImage() {
  if (!originalImg) return;

  let kR = int(document.getElementById("keyR").value);
  let kG = int(document.getElementById("keyG").value);
  let kB = int(document.getElementById("keyB").value);

  encodedImg = createImage(originalImg.width, originalImg.height);
  encodedImg.copy(originalImg, 0, 0, originalImg.width, originalImg.height, 0, 0, originalImg.width, originalImg.height);

  encodedImg.loadPixels();

  for (let i = 0; i < encodedImg.pixels.length; i += 4) {
    encodedImg.pixels[i]     = (encodedImg.pixels[i]     * kR) % 256;
    encodedImg.pixels[i + 1] = (encodedImg.pixels[i + 1] * kG) % 256;
    encodedImg.pixels[i + 2] = (encodedImg.pixels[i + 2] * kB) % 256;
  }

  encodedImg.updatePixels();

  background(255);
  drawImageFit(encodedImg);

  document.getElementById("downloadBtn").disabled = false;
}


// Télécharger
function downloadImage() {
  if (encodedImg) {
    encodedImg.save("kodiertes_bild.png");
  }
}
</script>

</body>
</html>

